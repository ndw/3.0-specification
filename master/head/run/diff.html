<?xml version="1.0" encoding="UTF-8"?><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><!--Generated by the DeltaXML.com xhtml-outfilter.xsl--><!--Using XSL Processor: Saxonica--><meta charset="utf-8" /><meta content="width=device-width, initial-scale=1, shrink-to-fit=no" name="viewport" /><link class="removeOnSave" crossorigin="anonymous" href="https://www.w3.org" rel="preconnect" /><link as="script" class="removeOnSave" href="js/fixup.js" rel="preload" /><link as="style" class="removeOnSave" href="css/base.css" rel="preload" /><link as="image" class="removeOnSave" href="https://www.w3.org/StyleSheets/TR/2016/logos/W3C" rel="preload" /><link rel="stylesheet" href="css/cg-draft.css" /><link rel="stylesheet" href="css/respec.css" /><link rel="alternate" title="XML" href="specification.xml" /><meta name="generator" content="DocBook XSL 2.0 Stylesheets V2.4.2" /><meta name="description" content="Abstract This specification describes the p:run&#xA;step for&#xA;XProc 3.1: An XML Pipeline Language." /><link href="css/default.css" rel="stylesheet" type="text/css" /><link href="css/db-prism.css" rel="stylesheet" type="text/css" /><link rel="stylesheet" type="text/css" href="css/base.css" /><link rel="stylesheet" type="text/css" href="css/xproc.css" /><link rel="stylesheet" type="text/css" href="css/print.css" media="print" /><script type="text/javascript" src="js/dbmodnizr.js"></script><title>-[[XProc 3.0: dynamic pipeline execution]]-</title><title>+[[XProc 3.1: dynamic pipeline execution]]+</title><style type="text/css">
          body { margin-top: 50px }
          a.button { background: #DDD; border: 2px outset black; padding: 2px; margin: 2px; font-family: sans-serif; font-size: small;}
          a.button:hover { cursor:pointer; }
          a.button:active { border-style: inset; }
        </style><script type="text/javascript">
            function view(doc) {
              var allSpans=document.getElementsByTagName("*");
              if(doc=="old") {
                for(i=0;i!=allSpans.length;i++) {
                  var displayType= "inline";
                  if (allSpans[i].localName == "tr") {
                    displayType= "table-row";
                  } else if (allSpans[i].localName == "li") {
                    displayType= "list-item";
                  }
                  var name=allSpans[i].className;
                  if(name=="deltaxml-new" || name=="deltaxml-new-img" || name=="deltaxml-new-format" || name=="add_version" || name=="modify_version") {
                    allSpans[i].style.display="none";
                  } else if (name=="deltaxml-old" || name=="deltaxml-old-img" || name=="deltaxml-old-format" || name=="delete_version") {
                    allSpans[i].style.display= displayType;
                    allSpans[i].style.background="#FFF";
                    //need to take border off images
                    var allImgs=allSpans[i].getElementsByTagName("img");
                    for(j=0;j!=allImgs.length;j++) {
                      allImgs[j].style.border="none";
                    }
                  }
                }
              } else if(doc=="new") {
                for(i=0;i!=allSpans.length;i++) {
                  var displayType= "inline";
                  if (allSpans[i].localName == "tr") {
                    displayType= "table-row";
                  } else if (allSpans[i].localName == "li") {
                    displayType= "list-item";
                  }
                  var name=allSpans[i].className;
                  if(name=="deltaxml-new" || name=="deltaxml-new-img" || name=="deltaxml-new-format" || name=="add_version") {
                    allSpans[i].style.display= displayType;
                    allSpans[i].style.background="#FFF";
                    //need to take border off images
                    var allImgs=allSpans[i].getElementsByTagName("img");
                    for(j=0;j!=allImgs.length;j++) {
                      allImgs[j].style.border="none";
                    }
                  } else if (name=="deltaxml-old" || name=="deltaxml-old-img" || name=="deltaxml-old-format" || name=="delete_version" || name=="modify_version") {
                    allSpans[i].style.display="none";
                   }
                }
              } else if(doc=="both") {
                for(i=0;i!=allSpans.length;i++) {
                  var displayType= "inline";
                  if (allSpans[i].localName == "tr") {
                    displayType= "table-row";
                  } else if (allSpans[i].localName == "li") {
                    displayType= "list-item";
                  }
                  var name=allSpans[i].className;
                  if(name=="deltaxml-new" || name=="deltaxml-new-format" || name=="deltaxml-new-img") {
                    allSpans[i].style.display= displayType;
                    allSpans[i].style.background="#90EE90";
                    //need to add border to images
                    var allImgs=allSpans[i].getElementsByTagName("img");
                    for(j=0;j!=allImgs.length;j++) {
                      allImgs[j].style.border="2px solid green";
                    }
                  } else if(name=="deltaxml-old" || name=="deltaxml-old-format" || name=="deltaxml-old-img") {
                    allSpans[i].style.display= displayType;
                    allSpans[i].style.background="#FF5555";
                    //need to add border to images
                    var allImgs=allSpans[i].getElementsByTagName("img");
                    for(j=0;j!=allImgs.length;j++) {
                      allImgs[j].style.border="2px solid red";
                    }
                  } else if (name=="add_version" || name=="delete_version") {
                    allSpans[i].style.display="none";
                  } else if (name=="modify_version") {
                    allSpans[i].style.display= displayType;
                  }
                }
              }
            }
  
        </script></head><body class="h-entry informative toc-sidebar"><div style="position:fixed; clear:both; top:0px"><p><a class="button" onclick="view('old')">
              View Old
            </a><a class="button" onclick="view('new')">
              View New
            </a><a class="button" onclick="view('both')">
              View Both
            </a></p></div><div id="spec.head" class="head"><a class="logo" href="https://www.w3.org/"><img alt="W3C" height="48" src="https://www.w3.org/StyleSheets/TR/2016/logos/W3C" width="72" /></a><h1 id="title" class="title p-name">XProc <span class="deltaxml-old" style="background:#FF5555">3.0</span><span class="deltaxml-new" style="background:#90EE90">3.1</span>: dynamic pipeline execution</h1><h2>Draft Community Group Report <time class="dt-published" datetime="2020-06-24">24 June 2020</time></h2><div class="editors-draft">Editor's Draft at <time class="dt-timestamp" datetime="20200624T14:35:44Z"><span class="deltaxml-old" style="background:#FF5555">11:59</span><span class="deltaxml-new" style="background:#90EE90">14:35</span> UTC</time> (<a href="https://github.com/xproc/3.0-steps/commit/a7a9d5527f61cf7e5dae3cea5f2c2667e127caf9">build <span class="deltaxml-old" style="background:#FF5555">484</span><span class="deltaxml-new" style="background:#90EE90">487</span></a>)</div><dl><dt>Latest editor’s draft:</dt><dd><a href="http://spec.xproc.org/master/head/run/">http://spec.xproc.org/master/head/run/</a></dd><dt>Editors:</dt><dd><span class="personname">Norman Walsh</span></dd><dd><span class="personname">Achim Berndzen</span></dd><dd><span class="personname">Gerrit Imsieke</span></dd><dd><span class="personname">Erik Siegel</span></dd><dt>Participate:</dt><dd><a href="http://github.com/xproc/3.0-steps">GitHub xproc/3.0-steps</a></dd><dd><a href="http://github.com/xproc/3.0-steps/issues">Report an issue</a></dd><dt>Changes:</dt><dd><a href="diff.html">Diff against current “status quo” draft</a></dd><dd><a href="http://github.com/xproc/3.0-steps/commits/master">Commits for this specification</a></dd></dl><p>This document is also available in these non-normative formats: <a href="specification.xml">XML</a>, automatic change markup <a href="diff.html">from the previous draft</a> courtesy of <a href="http://www.deltaxml.com/">DeltaXML</a>.</p><p class="copyright"><p class="copyright"><span style="display: none;" class="delete_version"><a href="https://www.w3.org/Consortium/Legal/ipr-notice#Copyright">Copyright</a> © <span class="years">2018, 2019, 2020</span> the Contributors to the <cite>XProc 3.0: dynamic pipeline execution</cite> specification, published by the <a href="https://www.w3.org/community/xproc-next/">XProc Next Community Group</a> under the <a href="https://www.w3.org/community/about/agreements/cla/">W3C Community Contributor License Agreement (CLA)</a>. A human-readable <a href="https://www.w3.org/community/about/agreements/cla-deed/">summary</a> is available.</span><span style="display: none;" class="add_version"><a href="https://www.w3.org/Consortium/Legal/ipr-notice#Copyright">Copyright</a> © <span class="years">2018, 2019, 2020</span> the Contributors to the <cite>XProc 3.1: dynamic pipeline execution</cite> specification, published by the <a href="https://www.w3.org/community/xproc-next/">XProc Next Community Group</a> under the <a href="https://www.w3.org/community/about/agreements/cla/">W3C Community Contributor License Agreement (CLA)</a>. A human-readable <a href="https://www.w3.org/community/about/agreements/cla-deed/">summary</a> is available.</span><span class="modify_version"><a href="https://www.w3.org/Consortium/Legal/ipr-notice#Copyright">Copyright</a> © <span class="years">2018, 2019, 2020</span> the Contributors to the <cite>XProc <span class="deltaxml-old" style="background:#FF5555">3.0</span><span class="deltaxml-new" style="background:#90EE90">3.1</span>: dynamic pipeline execution</cite> specification, published by the <a href="https://www.w3.org/community/xproc-next/">XProc Next Community Group</a> under the <a href="https://www.w3.org/community/about/agreements/cla/">W3C Community Contributor License Agreement (CLA)</a>. A human-readable <a href="https://www.w3.org/community/about/agreements/cla-deed/">summary</a> is available.</span></p></p><hr title="Separator for header" /><section id="abstract" class="introductory"><h2>Abstract</h2><p><span style="display: none;" class="delete_version">This specification describes the <code class="code">p:run</code> step for <em class="citetitle">XProc 3.0: An XML Pipeline Language</em>.</span><span style="display: none;" class="add_version">This specification describes the <code class="code">p:run</code> step for <em class="citetitle">XProc 3.1: An XML Pipeline Language</em>.</span><span class="modify_version">This specification describes the <code class="code">p:run</code> step for <em class="citetitle">XProc <span class="deltaxml-old" style="background:#FF5555">3.0</span><span class="deltaxml-new" style="background:#90EE90">3.1</span>: An XML Pipeline Language</em>.</span></p></section><section id="sotd" class="introductory"><h2>Status of this Document</h2><p><strong>This document is an editor's draft that has no official standing.</strong></p><p>This specification was published by the <a href="https://www.w3.org/community/xproc-next/">XProc Next Community Group</a>. It is not a W3C Standard nor is it on the W3C Standards Track. Please note that under the <a href="https://www.w3.org/community/about/agreements/cla/">W3C Community Contributor License Agreement (CLA)</a> there is a limited opt-out and other conditions apply. Learn more about <a href="https://www.w3.org/community/">W3C Community and Business Groups</a>. </p><p>If you wish to make comments regarding this document, please send them to <a href="mailto:xproc-dev@w3.org">xproc-dev@w3.org</a>. (<a href="mailto:xproc-dev-request@w3.org?subject=subscribe">subscribe</a>, <a href="https://lists.w3.org/Archives/Public/xproc-dev/">archives</a>). </p></section></div><div class="lists-of-titles"><nav id="toc"><h2 id="TableOfContents">Table of Contents</h2><ol class="toc"><li class="tocline"><a class="tocxref" href="#introduction"><bdi class="secno">1. </bdi>Introduction</a></li><li class="tocline"><a class="tocxref" href="#c.run"><bdi class="secno">2. </bdi>p:run</a><ul class="toc"><li class="tocline"><a class="tocxref" href="#c.run.11"><bdi class="secno"><span class="deltaxml-old" style="background:#FF5555">2.1. </span></bdi><span class="deltaxml-old" style="background:#FF5555">Document properties</span></a><a class="tocxref" href="#example-run"><bdi class="secno"><span class="deltaxml-new" style="background:#90EE90">2.1. </span></bdi><span class="deltaxml-new" style="background:#90EE90">Example</span></a></li><li class="add_version" style="display: none;"><a class="tocxref" href="#c.run.14"><bdi class="secno">2.2. </bdi>Document properties</a></li><li class="tocline"><a class="tocxref" href="#c.run.14"><bdi class="secno"><span class="deltaxml-new" style="background:#90EE90">2.2. </span></bdi><span class="deltaxml-new" style="background:#90EE90">Document properties</span></a></li></ul></li><li class="tocline"><a class="tocxref" href="#errors"><bdi class="secno">3. </bdi>Step Errors</a></li><li class="tocline"><a class="tocxref" href="#conformance"><bdi class="secno">A. </bdi>Conformance</a><ul class="toc"><li class="tocline"><a class="tocxref" href="#implementation-defined"><bdi class="secno">A.1. </bdi>Implementation-defined features</a></li><li class="tocline"><a class="tocxref" href="#implementation-dependent"><bdi class="secno">A.2. </bdi>Implementation-dependent features</a></li></ul></li><li class="tocline"><a class="tocxref" href="#references"><bdi class="secno">B. </bdi>References</a></li><li class="tocline"><a class="tocxref" href="#glossary"><bdi class="secno">C. </bdi>Glossary</a></li><li class="tocline"><a class="tocxref" href="#ancillary-files"><bdi class="secno">D. </bdi>Ancillary files</a></li></ol></nav></div><article class="specification"><section class="section" id="introduction"><div class="section-titlepage"><h2><bdi class="secno">1. </bdi>Introduction<a aria-label="§" class="self-link" href="#introduction"></a></h2></div><div class="content"><p>This specification describes the <code class="code">p:run</code> XProc step. A machine-readable description of these steps may be found in <a href="steps.xpl">steps.xpl</a>. </p><div class="note editorial admonition"><h3><span class="deltaxml-new" style="background:#90EE90">Note</span></h3><div class="admonition-body"><p><span class="deltaxml-new" style="background:#90EE90">It will most probably end up in an XProc document of its own.</span></p></div></div><p>Familarity with the general nature of [<a href="#xproc30"><span class="abbrev">XProc 3.0</span></a>] steps is assumed; for background details, see [<a href="#xproc30-steps"><span class="abbrev">XProc 3.0 Steps</span></a>].</p></div></section><section class="section" id="c.run"><div class="section-titlepage"><h2><bdi class="secno">2. </bdi>p:run<a aria-label="§" class="self-link" href="#c.run"></a></h2></div><div class="content"><p>The <code class="tag-element">p:run</code> step runs a dynamically loaded pipeline.</p><p class="element-syntax element-syntax-declare-step"><span class="decl"><code><span class="deltaxml-old" style="background:#FF5555">&lt;p:declare-step</span></code><code class="attr type-attr"><span class="deltaxml-old" style="background:#FF5555">type</span></code><code><span class="deltaxml-old" style="background:#FF5555">="</span></code><code class="value type-value"><span class="deltaxml-old" style="background:#FF5555">p:run</span></code><code><span class="deltaxml-old" style="background:#FF5555">"</span></code><code><span class="deltaxml-old" style="background:#FF5555">&gt;</span></code></span><span class="deltaxml-old" style="background:#FF5555">     </span><span class="input"><code><span class="deltaxml-old" style="background:#FF5555">&lt;p:input</span></code><code class="attr port-attr"><span class="deltaxml-old" style="background:#FF5555">port</span></code><code><span class="deltaxml-old" style="background:#FF5555">="</span></code><code class="value port-value"><span class="deltaxml-old" style="background:#FF5555">source</span></code><code><span class="deltaxml-old" style="background:#FF5555">"</span></code><code class="attr primary-attr"><span class="deltaxml-old" style="background:#FF5555">primary</span></code><code><span class="deltaxml-old" style="background:#FF5555">="</span></code><code class="value primary-value"><span class="deltaxml-old" style="background:#FF5555">true</span></code><code><span class="deltaxml-old" style="background:#FF5555">"</span></code><code class="attr sequence-attr"><span class="deltaxml-old" style="background:#FF5555">sequence</span></code><code><span class="deltaxml-old" style="background:#FF5555">="</span></code><code class="value sequence-value"><span class="deltaxml-old" style="background:#FF5555">true</span></code><code><span class="deltaxml-old" style="background:#FF5555">"</span></code><code class="attr content-types-attr"><span class="deltaxml-old" style="background:#FF5555">content-types</span></code><code><span class="deltaxml-old" style="background:#FF5555">="</span></code><code class="value content-types-value"><span class="deltaxml-old" style="background:#FF5555">any</span></code><code><span class="deltaxml-old" style="background:#FF5555">"</span></code><code><span class="deltaxml-old" style="background:#FF5555">/&gt;</span></code></span><span class="deltaxml-old" style="background:#FF5555">     </span><span class="input"><code><span class="deltaxml-old" style="background:#FF5555">&lt;p:output</span></code><code class="attr port-attr"><span class="deltaxml-old" style="background:#FF5555">port</span></code><code><span class="deltaxml-old" style="background:#FF5555">="</span></code><code class="value port-value"><span class="deltaxml-old" style="background:#FF5555">result</span></code><code><span class="deltaxml-old" style="background:#FF5555">"</span></code><code class="attr primary-attr"><span class="deltaxml-old" style="background:#FF5555">primary</span></code><code><span class="deltaxml-old" style="background:#FF5555">="</span></code><code class="value primary-value"><span class="deltaxml-old" style="background:#FF5555">true</span></code><code><span class="deltaxml-old" style="background:#FF5555">"</span></code><code class="attr content-types-attr"><span class="deltaxml-old" style="background:#FF5555">content-types</span></code><code><span class="deltaxml-old" style="background:#FF5555">="</span></code><code class="value content-types-value"><span class="deltaxml-old" style="background:#FF5555">any</span></code><code><span class="deltaxml-old" style="background:#FF5555">"</span></code><code><span class="deltaxml-old" style="background:#FF5555">/&gt;</span></code></span><code><span class="deltaxml-old" style="background:#FF5555">&lt;/p:declare-step&gt;</span></code></p><p><span class="deltaxml-old" style="background:#FF5555">THIS IS UNREVIEWED PLACHOLDER TEXT</span></p><div class="note editorial admonition"><h3><span class="deltaxml-new" style="background:#90EE90">Note</span></h3><div class="admonition-body"><p><span class="deltaxml-new" style="background:#90EE90">GI 2020-04-26: I commented out </span><code class="literal"><span class="deltaxml-new" style="background:#90EE90">&lt;e:rng-pattern name="Run"/&gt;</span></code><span class="deltaxml-new" style="background:#90EE90"> temporarily since I don’t know how to render the pattern that is currently in </span><a href="https://github.com/gimsieke/3.0-grammar/blob/run/steps/step-run/steps.rnc"><span class="deltaxml-new" style="background:#90EE90">steps/step-run/steps.rnc</span></a><span class="deltaxml-new" style="background:#90EE90"> (</span><a href="https://github.com/xproc/3.0-grammar/pull/17"><span class="deltaxml-new" style="background:#90EE90">PR</span></a><span class="deltaxml-new" style="background:#90EE90"> pending).</span></p></div></div><p><span style="display: none;" class="delete_version">The <code class="tag-element">p:run</code> step functions mostly like an atomic step in that you can define inputs connections and option values for it. However, unlike atomic steps, it has no defined signature. Any inputs are allowed and any outputs may be connected. </span><span style="display: none;" class="add_version">The <code class="tag-element">p:run</code> step functions mostly like an atomic step in that you can define inputs connections and option values for it. However, unlike atomic steps, it has no fixed signature. Any inputs are allowed and any outputs may be connected. </span><span class="modify_version">The <code class="tag-element">p:run</code> step functions mostly like an atomic step in that you can define inputs connections and option values for it. However, unlike atomic steps, it has no <span class="deltaxml-old" style="background:#FF5555">defined</span><span class="deltaxml-new" style="background:#90EE90">fixed</span> signature. Any inputs are allowed and any outputs may be connected. </span></p><p>One input port is specifically designated the pipeline input port. By default, that port is named <code class="port">pipeline</code>, but its name can be changed by specifying a different name in the <code class="option">p:pipeline</code> option. </p><p>The <code class="tag-element">p:run</code> step expects a single pipeline document on the pipeline port. <a id="err.inline.C0080"></a>It is a <em class="glossterm"><a href="#dt-dynamic-error">dynamic error</a></em> (<a href="#err.C0080"><code class="errqname">err:XC0080</code></a>) if the pipeline input to the <code class="tag-element">p:run</code> step is not a valid pipeline. </p><p><span style="display: none;" class="delete_version">The pipeline that appears on the pipeline port is evaluated using the inputs and options specified on the <code class="tag-element">p:run</code> step. <a id="err.inline.C0081"></a>It is a <em class="glossterm"><a href="#dt-dynamic-error">dynamic error</a></em> (<a href="#err.C0081"><code class="errqname">err:XC0081</code></a>) if the pipeline has inputs that are not specified on the <code class="tag-element">p:run</code> step. <a id="err.inline.C0082"></a>It is a <em class="glossterm"><a href="#dt-dynamic-error">dynamic error</a></em> (<a href="#err.C0082"><code class="errqname">err:XC0082</code></a>) if the pipeline has required options that are not specified on the <code class="tag-element">p:run</code> step. </span><span style="display: none;" class="add_version">The pipeline that appears on the pipeline port is evaluated using the inputs and options specified on the <code class="tag-element">p:run</code> step. The default readable port of the <code class="tag-element">p:run</code> step becomes the default readable port of the pipeline. <a id="err.inline.C0081"></a>It is a <em class="glossterm"><a href="#dt-dynamic-error">dynamic error</a></em> (<a href="#err.C0081"><code class="errqname">err:XC0081</code></a>) if the pipeline has declared inputs that are not specified on the <code class="tag-element">p:run</code> step. <a id="err.inline.C0082"></a>It is a <em class="glossterm"><a href="#dt-dynamic-error">dynamic error</a></em> (<a href="#err.C0082"><code class="errqname">err:XC0082</code></a>) if the pipeline has required options that are not specified on the <code class="tag-element">p:run</code> invocation. </span><span class="modify_version">The pipeline that appears on the pipeline port is evaluated using the inputs and options specified on the <code class="tag-element">p:run</code> step. <span class="deltaxml-new" style="background:#90EE90">The default readable port of the </span><code class="tag-element"><span class="deltaxml-new" style="background:#90EE90">p:run</span></code><span class="deltaxml-new" style="background:#90EE90"> step becomes the default readable port of the pipeline. </span><a id="err.inline.C0081"></a>It is a <em class="glossterm"><a href="#dt-dynamic-error">dynamic error</a></em> (<a href="#err.C0081"><code class="errqname">err:XC0081</code></a>) if the pipeline has <span class="deltaxml-new" style="background:#90EE90">declared </span>inputs that are not specified on the <code class="tag-element">p:run</code> step. <a id="err.inline.C0082"></a>It is a <em class="glossterm"><a href="#dt-dynamic-error">dynamic error</a></em> (<a href="#err.C0082"><code class="errqname">err:XC0082</code></a>) if the pipeline has required options that are not specified on the <code class="tag-element">p:run</code> <span class="deltaxml-old" style="background:#FF5555">step</span><span class="deltaxml-new" style="background:#90EE90">invocation</span>. </span></p><div id="ednote-run-required-options" class="note editorial admonition"><h3><span class="deltaxml-new" style="background:#90EE90">Note</span></h3><div class="admonition-body"><p><span class="deltaxml-new" style="background:#90EE90">Do we really need to have C0082? Isn’t it sufficient that the dynamically executed pipeline raises an error if a required option is missing?</span></p><p><span class="deltaxml-new" style="background:#90EE90">If we raise this error on </span><code class="tag-element"><span class="deltaxml-new" style="background:#90EE90">p:run</span></code><span class="deltaxml-new" style="background:#90EE90">, we might as well require that the types of the options given on </span><code class="tag-element"><span class="deltaxml-new" style="background:#90EE90">p:run</span></code><span class="deltaxml-new" style="background:#90EE90"> be compatible with what the pipeline’s option expects. Instead of raising such an error on </span><code class="tag-element"><span class="deltaxml-new" style="background:#90EE90">p:run</span></code><span class="deltaxml-new" style="background:#90EE90">, we can wait until the pipeline is executed and any dynamic errors occur in the pipeline.</span></p></div></div><p><span class="deltaxml-new" style="background:#90EE90">Each output port of the pipeline can appear as a same-named output port of the </span><code class="tag-element"><span class="deltaxml-new" style="background:#90EE90">p:run</span></code><span class="deltaxml-new" style="background:#90EE90"> step. In order for this to happen, the port needs to be explicitly declared in the </span><code class="tag-element"><span class="deltaxml-new" style="background:#90EE90">p:run</span></code><span class="deltaxml-new" style="background:#90EE90"> step. In contrast to output declarations of compound steps or of </span><code class="tag-element"><span class="deltaxml-new" style="background:#90EE90">p:declare-pipeline</span></code><span class="deltaxml-new" style="background:#90EE90"> with a subpipeline, such an output declaration may not establish a connection to any port of another step or of the pipeline to be run.</span></p><p><span style="display: none;" class="delete_version">The outputs of the pipeline appear on the correspondingly named output ports of the <code class="tag-element">p:run</code> step. If the pipeline has an output is not bound on the <code class="tag-element">p:run</code> step, that output is discarded. If the <code class="tag-element">p:run</code> step has an output port that is not provided by the pipeline, an empty sequence appears on that port. </span><span style="display: none;" class="add_version">If the pipeline has an output that is not declared on the <code class="tag-element">p:run</code> step, that output is discarded, and the corresponding port on the <code class="tag-element">p:run</code> step does not exist. If the <code class="tag-element">p:run</code> step declares an output port that is not provided by the pipeline, an empty sequence appears on that port.</span><span class="modify_version"><span class="deltaxml-old" style="background:#FF5555">The outputs of the pipeline appear on the correspondingly named output ports of</span><span class="deltaxml-new" style="background:#90EE90">If the pipeline has an output that is not declared on</span> the <code class="tag-element">p:run</code> step<span class="deltaxml-old" style="background:#FF5555">. If the pipeline has an output is not bound</span><span class="deltaxml-new" style="background:#90EE90">, that output is discarded, and the corresponding port</span> on the <code class="tag-element">p:run</code> step<span class="deltaxml-old" style="background:#FF5555">, that output is discarded</span><span class="deltaxml-new" style="background:#90EE90"> does not exist</span>. If the <code class="tag-element">p:run</code> step <span class="deltaxml-old" style="background:#FF5555">has</span><span class="deltaxml-new" style="background:#90EE90">declares</span> an output port that is not provided by the pipeline, an empty sequence appears on that port.<span class="deltaxml-old" style="background:#FF5555"> </span></span></p><p><span class="deltaxml-old" style="background:#FF5555">The </span><code class="tag-element"><span class="deltaxml-old" style="background:#FF5555">p:run</span></code><span class="deltaxml-old" style="background:#FF5555"> step is assumed to have a primary output port. If the pipeline evaluated does not have a primary output port, an empty sequence appears on that port. (Alternatively, that could be a dynamic error) </span></p><section id="c.run.11" class="section"><div class="section-titlepage"><h3><bdi class="secno"><span class="deltaxml-old" style="background:#FF5555">2.1. </span></bdi><span class="deltaxml-old" style="background:#FF5555">Document properties</span><a aria-label="§" class="self-link" href="#"></a></h3></div><div class="content"><p><span class="deltaxml-old" style="background:#FF5555">No document properties are preserved.</span></p></div></section><div id="ednote-run-empty-input" class="note editorial admonition"><h3><span class="deltaxml-new" style="background:#90EE90">Note</span></h3><div class="admonition-body"><p><span class="deltaxml-new" style="background:#90EE90">Should we do a similar thing for inputs? That is, if the pipeline declares an input but the </span><code class="tag-element"><span class="deltaxml-new" style="background:#90EE90">p:run</span></code><span class="deltaxml-new" style="background:#90EE90"> invocation doesn’t provide a connection, it is treated as if the connection were declared explicitly empty. If we do so, C0081 is no error any more. </span></p><p><span class="deltaxml-new" style="background:#90EE90">This might be useful in that it extends the range of pipelines that a given </span><code class="tag-element"><span class="deltaxml-new" style="background:#90EE90">p:run</span></code><span class="deltaxml-new" style="background:#90EE90"> invocation may run. Suppose that you modified an EPUB building step by adding an input port that accepts a text document with extra CSS to be used by every HTML page within the EPUB. So this extended EPUB step has an additional input port </span><code class="literal"><span class="deltaxml-new" style="background:#90EE90">extra-css</span></code><span class="deltaxml-new" style="background:#90EE90"> in addition to its (hypothetic) normal ports </span><code class="literal"><span class="deltaxml-new" style="background:#90EE90">source</span></code><span class="deltaxml-new" style="background:#90EE90"> and </span><code class="literal"><span class="deltaxml-new" style="background:#90EE90">conf</span></code><span class="deltaxml-new" style="background:#90EE90">. It would be perfectly useful to run this extended EPUB building pipeline as if it were the standard EPUB building pipeline. It will see zero documents on its </span><code class="literal"><span class="deltaxml-new" style="background:#90EE90">extra-css</span></code><span class="deltaxml-new" style="background:#90EE90"> port, which is fine.</span></p><p><span class="deltaxml-new" style="background:#90EE90">In that sense, a </span><code class="tag-element"><span class="deltaxml-new" style="background:#90EE90">p:run</span></code><span class="deltaxml-new" style="background:#90EE90"> invocation declares an </span><em><span class="deltaxml-new" style="background:#90EE90">interface</span></em><span class="deltaxml-new" style="background:#90EE90"> that the dynamically executed pipelines must implement but may extend.</span></p><p><span class="deltaxml-new" style="background:#90EE90">We don’t do this default-to-empty for unsaturated input connections of other step invocations, do we?</span></p><p><span class="deltaxml-new" style="background:#90EE90">Likewise, what happens if the </span><code class="tag-element"><span class="deltaxml-new" style="background:#90EE90">p:run</span></code><span class="deltaxml-new" style="background:#90EE90"> invocation has a </span><code class="tag-element"><span class="deltaxml-new" style="background:#90EE90">p:with-option</span></code><span class="deltaxml-new" style="background:#90EE90"> element (or an option attribute) that does not exist in the pipeline? I suggest that this option be simply ignored, no attempt be made by the processor to pass this option to the pipeline, no error raised.</span></p></div></div><div id="ednote-run-always-primary-output" class="note editorial admonition"><h3><span class="deltaxml-new" style="background:#90EE90">Note</span></h3><div class="admonition-body"><p><span class="deltaxml-new" style="background:#90EE90">This was Norm’s original draft:</span></p><blockquote><p><span class="deltaxml-new" style="background:#90EE90">The </span><code class="tag-element"><span class="deltaxml-new" style="background:#90EE90">p:run</span></code><span class="deltaxml-new" style="background:#90EE90"> step is assumed to have a primary output port. If the pipeline evaluated does not have a primary output port, an empty sequence appears on that port. Alternatively, that could be a dynamic error.</span></p></blockquote><p><span class="deltaxml-new" style="background:#90EE90">I think Norm has proposed both alternatives before he agreed that a </span><code class="tag-element"><span class="deltaxml-new" style="background:#90EE90">p:run</span></code><span class="deltaxml-new" style="background:#90EE90"> step needs to declare its outputs. With these output declarations mandatory, can we safely omit the primary port requirement?</span></p></div></div><section id="example-run" class="section"><div class="section-titlepage"><h3><bdi class="secno"><span class="deltaxml-new" style="background:#90EE90">2.1. </span></bdi><span class="deltaxml-new" style="background:#90EE90">Example</span><a aria-label="§" class="self-link" href="#example-run"></a></h3></div><div class="content"><figure id="ex.c.run" class="example-wrapper"><div class="title"><span class="deltaxml-new" style="background:#90EE90">Example 1. Dynamic Execution of a Transformation/Validation Pipeline</span></div><div class="example"><pre class="programlisting language-markup line-numbers xml"><code><span class="deltaxml-new" style="background:#90EE90">&lt;p:run name="runme" xslt-parameters="{map{{'foo':'bar'}}}"&gt; &lt;p:with-input port="pipeline"&gt; &lt;p:inline expand-text="true"&gt; &lt;p:declare-step name="transform-n-validate"&gt; &lt;p:input name="source" primary="true" sequence="true"/&gt; &lt;p:input name="stylesheet"/&gt; &lt;p:input name="xsd"/&gt; &lt;p:option name="assert-valid" as="xs:boolean" select="false()"/&gt; &lt;p:option name="xslt-parameters" as="map(xs:QName, item()*)?"/&gt; &lt;p:output port="result" primary="true"/&gt; &lt;p:output port="report" pipe="report@xsdval"/&gt; &lt;p:xslt parameters="{$xslt-parameters}"&gt; &lt;p:with-input port="stylesheet" pipe="stylesheet"/&gt; &lt;/p:xslt&gt; &lt;p:validate-with-xml-schema assert-valid="{$assert-valid}" name="xsdval"&gt; &lt;p:with-input port="schema" pipe="xsd"/&gt; &lt;/p:validate-with-xml-schema&gt; &lt;/p:declare-step&gt; &lt;/p:inline&gt; &lt;/p:with-input&gt; &lt;p:with-input name="source" href="my.xml"/&gt; &lt;p:with-input name="stylesheet" href="my.xsl"/&gt; &lt;p:with-input name="xsd" href="my.xsd"/&gt; &lt;p:output port="result" primary="true"/&gt; &lt;p:output port="report"/&gt; &lt;/p:run&gt;</span></code></pre></div></figure></div></section><section id="c.run.14" class="section"><div class="section-titlepage"><h3><bdi class="secno"><span class="deltaxml-new" style="background:#90EE90">2.2. </span></bdi><span class="deltaxml-new" style="background:#90EE90">Document properties</span><a aria-label="§" class="self-link" href="#"></a></h3></div><div class="content"><p><span class="deltaxml-new" style="background:#90EE90">No document properties are preserved.</span></p><div id="ednote-run-docprops" class="note editorial admonition"><h3><span class="deltaxml-new" style="background:#90EE90">Note</span></h3><div class="admonition-body"><p><span class="deltaxml-new" style="background:#90EE90">Shouldn’t we say, the extent to which document properties are preserved depend on the steps in the dynamically executed pipeline?</span></p></div></div></div></section></div></section><section id="errors" class="section"><div class="section-titlepage"><h2><bdi class="secno">3. </bdi>Step Errors<a aria-label="§" class="self-link" href="#errors"></a></h2></div><div class="content"><p>This step can raise <em class="glossterm"><a href="#dt-dynamic-error">dynamic errors</a></em>. </p><p><span id="dt-dynamic-error" class="termdef">[Definition: A <em class="glossterm">dynamic error</em> is one which occurs while a pipeline is being evaluated.]</span> Examples of dynamic errors include references to URIs that cannot be resolved, steps which fail, and pipelines that exhaust the capacity of an implementation (such as memory or disk space). For a more complete discussion of dynamic errors, see <cite><a href="../xproc/#dynamic-errors">Dynamic Errors</a></cite> in <cite><a href="../xproc/">XProc 3.0: An XML Pipeline Language</a></cite>. </p><p>If a step fails due to a dynamic error, failure propagates upwards until either a <code class="tag-element">p:try</code> is encountered or the entire pipeline fails. In other words, outside of a <code class="tag-element">p:try</code>, step failure causes the entire pipeline to fail.</p><p>The following errors can be raised by this step:</p><div id="step-error-summary"><dl class="errs"><dt id="err.C0080"><code class="errqname">err:XC0080</code></dt><dd><p>It is a dynamic error if the pipeline input to the p:run step is not a valid pipeline. </p><p>See: <a href="#err.inline.C0080">p:run</a></p></dd><dt id="err.C0081"><code class="errqname">err:XC0081</code></dt><dd><p>It is a dynamic error if the pipeline has <span class="deltaxml-new" style="background:#90EE90">declared </span>inputs that are not specified on the p:run step. </p><p>See: <a href="#err.inline.C0081">p:run</a></p></dd><dt id="err.C0082"><code class="errqname">err:XC0082</code></dt><dd><p>It is a dynamic error if the pipeline has required options that are not specified on the p:run <span class="deltaxml-old" style="background:#FF5555">step</span><span class="deltaxml-new" style="background:#90EE90">invocation</span>. </p><p>See: <a href="#err.inline.C0082">p:run</a></p></dd></dl></div></div></section><article id="conformance" class="appendix"><header class="appendix-titlepage"><h2><bdi class="secno">A. </bdi>Conformance<a aria-label="§" class="self-link" href="#conformance"></a></h2></header><div class="content"><p>Conformant processors <span class="rfc2119" id="conformance.2.1">must</span> implement all of the features described in this specification except those that are explicitly identified as optional.</p><p>Some aspects of processor behavior are not completely specified; those features are either <em class="glossterm"><a href="#dt-implementation-dependent">implementation-dependent</a></em> or <em class="glossterm"><a href="#dt-implementation-defined">implementation-defined</a></em>.</p><p><span id="dt-implementation-dependent" class="termdef">[Definition: An <em class="glossterm">implementation-dependent</em> feature is one where the implementation has discretion in how it is performed. Implementations are not required to document or explain how <em class="glossterm"><a href="#dt-implementation-dependent">implementation-dependent</a></em> features are performed.]</span></p><p><span id="dt-implementation-defined" class="termdef">[Definition: An <em class="glossterm">implementation-defined</em> feature is one where the implementation has discretion in how it is performed. Conformant implementations <span class="rfc2119" id="dt-implementation-defined.2">must</span> document how <em class="glossterm"><a href="#dt-implementation-defined">implementation-defined</a></em> features are performed.]</span></p><section id="implementation-defined" class="section"><div class="section-titlepage"><h2><bdi class="secno">A.1. </bdi>Implementation-defined features<a aria-label="§" class="self-link" href="#implementation-defined"></a></h2></div><div class="content"><p>The following features are implementation-defined:</p><ol class="features"></ol></div></section><section id="implementation-dependent" class="section"><div class="section-titlepage"><h2><bdi class="secno">A.2. </bdi>Implementation-dependent features<a aria-label="§" class="self-link" href="#implementation-dependent"></a></h2></div><div class="content"><p>The following features are implementation-dependent:</p><ol class="features"></ol></div></section></div></article><article id="references" class="appendix"><header class="appendix-titlepage"><h2><bdi class="secno">B. </bdi>References<a aria-label="§" class="self-link" href="#references"></a></h2></header><div class="content"><div id="references.2" class="bibliolist"><div id="xproc30" class="bibliomixed"><p>[<span class="abbrev">XProc 3.0</span>] <a href="http://spec.xproc.org/"><span class="citetitle"><cite>XProc 3.0: An XML Pipeline Language</cite></span></a>. Norman Walsh, Achim Berndzen, Gerrit Imsieke and Erik Siegel, editors. </p></div><div id="xproc30-steps" class="bibliomixed"><p>[<span class="abbrev">XProc 3.0 Steps</span>] <a href="http://spec.xproc.org/"><span class="citetitle"><cite>XProc 3.0 Steps: An Introduction</cite></span></a>. Norman Walsh, Achim Berndzen, Gerrit Imsieke and Erik Siegel, editors. </p></div></div></div></article><article id="glossary" class="appendix"><header class="appendix-titlepage"><h2><bdi class="secno">C. </bdi>Glossary<a aria-label="§" class="self-link" href="#glossary"></a></h2></header><div class="content"><div class="glosslist"><dl><dt id="glossary.2.1" class="glossentry"><em class="glossterm"><a href="#dt-dynamic-error">dynamic error</a></em></dt><dd class="glossdef"><p>A <em class="firstterm">dynamic error</em> is one which occurs while a pipeline is being evaluated.</p></dd><dt id="glossary.2.2" class="glossentry"><em class="glossterm"><a href="#dt-implementation-defined">implementation-defined</a></em></dt><dd class="glossdef"><p>An <em class="firstterm">implementation-defined</em> feature is one where the implementation has discretion in how it is performed. Conformant implementations <span class="rfc2119" id="glossary.2.2.2.1.2">must</span> document how <em class="glossterm"><a href="#dt-implementation-defined">implementation-defined</a></em> features are performed.</p></dd><dt id="glossary.2.3" class="glossentry"><em class="glossterm"><a href="#dt-implementation-dependent">implementation-dependent</a></em></dt><dd class="glossdef"><p>An <em class="firstterm">implementation-dependent</em> feature is one where the implementation has discretion in how it is performed. Implementations are not required to document or explain how <em class="glossterm"><a href="#dt-implementation-dependent">implementation-dependent</a></em> features are performed.</p></dd></dl></div></div></article><article id="ancillary-files" class="appendix"><header class="appendix-titlepage"><h2><bdi class="secno">D. </bdi>Ancillary files<a aria-label="§" class="self-link" href="#ancillary-files"></a></h2></header><div class="content"><p>This specification includes by reference a number of ancillary files.</p><div class="variablelist"><dl><dt><span class="term"><a href="steps.xpl">steps.xpl</a></span></dt><dd><p>An XProc step library for the declared steps. </p></dd></dl></div></div></article></article><script src="js/prism.js"></script><script src="js/fixup.js"></script></body></html>